---
layout: page
title: Conferences
permalink: /conferences.html
---

<style>
  /* Conference tracker: Bootstrap-friendly styling to match the rest of the site */
  #conferences-app .tabs { margin: 15px 0 20px; }
  #conferences-app .tabs .btn { margin-right: 6px; }
  #conferences-app .tabs .btn.active {
    background: #01579B;
    border-color: #01579B;
    color: #fff;
  }
  #conferences-app .stat {
    padding: 12px;
    border: 1px solid #eee;
    border-radius: 6px;
    background: #fafafa;
    text-align: center;
  }
  #conferences-app .stat .value {
    font-size: 28px;
    font-weight: 700;
    line-height: 1.1;
    color: #01579B;
  }
  #conferences-app .conf-title { font-weight: 700; font-size: 18px; }
  #conferences-app .conf-meta { color: #777; font-size: 14px; }
  #conferences-app .list-group-item { text-align: left; }
  #conferences-app .small-actions {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
  }
  @media (max-width: 768px) {
    #conferences-app .small-actions { justify-content: flex-start; }
  }
</style>

<section id="conferences-app">
  <div class="container">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4 style="margin-top: 0;">Conference Deadline Tracker</h4>
        <p class="text-muted">
          Track important conference dates, get browser notifications, and save updates to <code>conferences.json</code> via your Vercel API.
        </p>

        <div class="tabs" role="tablist" aria-label="Conferences tabs">
          <button id="tabList" type="button" class="btn btn-default active">All conferences / journals</button>
          <button id="tabAdd" type="button" class="btn btn-default">Add new</button>
        </div>

        <div id="sectionList">
          <div class="row" style="margin-top: 10px;">
            <div class="col-sm-4">
              <div class="stat">
                <div class="value" id="totalCount">0</div>
                <div class="conf-meta">Tracked conferences</div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="stat">
                <div class="value" id="upcomingCount">0</div>
                <div class="conf-meta">Upcoming</div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="stat">
                <div class="value" id="soonCount">0</div>
                <div class="conf-meta">Due within 14 days</div>
              </div>
            </div>
          </div>

          <hr />

          <div class="row" style="margin-bottom: 10px;">
            <div class="col-sm-12">
              <div class="btn-toolbar" role="toolbar" aria-label="Conferences actions">
                <div class="btn-group btn-group-sm" role="group">
                  <button id="enableNotifBtn" type="button" class="btn btn-primary">Enable notifications</button>
                  <button id="checkNowBtn" type="button" class="btn btn-default">Check now</button>
                  <button id="exportBtn" type="button" class="btn btn-default">Export JSON</button>
                  <button id="importBtn" type="button" class="btn btn-default">Import JSON</button>
                </div>
              </div>
              <p class="help-block" id="notifStatus" style="margin-top: 8px;"></p>
            </div>
          </div>

          <div id="list" class="list-group"></div>
        </div>

        <div id="sectionAdd" style="display:none;">
          <h4 id="formTitle">Add a conference</h4>

          <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                <label for="nameInput">Name</label>
                <input id="nameInput" class="form-control" type="text" placeholder="Conference name (e.g., ISWC 2027)" />
              </div>
            </div>
            <div class="col-sm-3">
              <div class="form-group">
                <label for="rankInput">Rank</label>
                <input id="rankInput" class="form-control" type="text" placeholder="A, A*, B..." />
              </div>
            </div>
            <div class="col-sm-3">
              <div class="form-group">
                <label for="categoryInput">Category</label>
                <select id="categoryInput" class="form-control">
                  <option value="AI">AI</option>
                  <option value="NLP">NLP</option>
                  <option value="Semantic Web">Semantic Web</option>
                  <option value="EdTech">EdTech</option>
                  <option value="Data Mining">Data Mining</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                <label for="locationInput">Location / notes</label>
                <input id="locationInput" class="form-control" type="text" placeholder="Location / notes" />
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label for="urlInput">CFP URL (optional)</label>
                <input id="urlInput" class="form-control" type="url" placeholder="https://..." />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-4">
              <div class="form-group">
                <label for="deadlineInput">Deadline</label>
                <input id="deadlineInput" class="form-control" type="datetime-local" />
              </div>
            </div>
            <div class="col-sm-4">
              <div class="form-group">
                <label for="notifyDaysInput">Notify days before</label>
                <input id="notifyDaysInput" class="form-control" type="number" min="0" value="14" />
              </div>
            </div>
            <div class="col-sm-4">
              <div class="form-group">
                <label for="sourceInput">Source note</label>
                <input id="sourceInput" class="form-control" type="text" placeholder="manual, WikiCFP..." />
              </div>
            </div>
          </div>

          <button id="addBtn" type="button" class="btn btn-primary btn-block">Add conference</button>
          <button id="cancelEditBtn" type="button" class="btn btn-default btn-block" style="display:none;">Cancel edit</button>
        </div>
      </div>
    </div>
  </div>
</section>

  <script>
    const STORAGE_KEY = 'conference-deadline-tracker-v1';
    let conferences = [];
    let notifiedMap = {};

    const els = {
      list: document.getElementById('list'),
      totalCount: document.getElementById('totalCount'),
      upcomingCount: document.getElementById('upcomingCount'),
      soonCount: document.getElementById('soonCount'),
      notifStatus: document.getElementById('notifStatus'),
      formTitle: document.getElementById('formTitle'),
      nameInput: document.getElementById('nameInput'),
      rankInput: document.getElementById('rankInput'),
      locationInput: document.getElementById('locationInput'),
      urlInput: document.getElementById('urlInput'),
      deadlineInput: document.getElementById('deadlineInput'),
      notifyDaysInput: document.getElementById('notifyDaysInput'),
      categoryInput: document.getElementById('categoryInput'),
      sourceInput: document.getElementById('sourceInput'),
      addBtn: document.getElementById('addBtn'),
      cancelEditBtn: document.getElementById('cancelEditBtn')
    };

    let editingId = null;

    function uid() {
      return `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;
    }

    async function loadConferences() {
      // try to fetch a JSON file from the site root first
      try {
        const resp = await fetch('{{ site.baseurl }}/conferences.json');
        if (resp.ok) {
          const data = await resp.json();
          if (Array.isArray(data)) {
            return data;
          }
        }
      } catch (e) {
        // ignore, fall back to storage
      }

      // fallback to localStorage if fetch failed or returned non-array
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveConferences() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(conferences));
    }

    function loadNotifiedMap() {
      try {
        const raw = localStorage.getItem(`${STORAGE_KEY}-notified`);
        return raw ? JSON.parse(raw) : {};
      } catch {
        return {};
      }
    }

    function saveNotifiedMap() {
      localStorage.setItem(`${STORAGE_KEY}-notified`, JSON.stringify(notifiedMap));
    }

    function formatDate(dt) {
      const d = new Date(dt);
      return d.toLocaleString([], {
        year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit'
      });
    }

    function daysRemaining(deadline) {
      const now = new Date();
      const diffMs = new Date(deadline).getTime() - now.getTime();
      return diffMs / (1000 * 60 * 60 * 24);
    }

    function getStatus(conf) {
      const days = daysRemaining(conf.deadline);
      if (days < 0) return { label: 'Passed', cls: 'label-danger' };
      if (days <= 14) return { label: 'Soon', cls: 'label-warning' };
      return { label: 'Upcoming', cls: 'label-success' };
    }

    function render() {
      const sorted = [...conferences].sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
      const upcoming = sorted.filter(c => daysRemaining(c.deadline) >= 0);
      const soon = sorted.filter(c => {
        const d = daysRemaining(c.deadline);
        return d >= 0 && d <= 14;
      });

      els.totalCount.textContent = sorted.length;
      els.upcomingCount.textContent = upcoming.length;
      els.soonCount.textContent = soon.length;

      if (!sorted.length) {
        els.list.innerHTML = '<div class="alert alert-info" style="margin: 0;">No conferences yet. Click “Add new” to create one, or use “Import JSON”.</div>';
        return;
      }

      els.list.innerHTML = sorted.map(conf => {
        const status = getStatus(conf);
        const remaining = daysRemaining(conf.deadline);
        const humanRemaining = remaining < 0
          ? `${Math.abs(Math.ceil(remaining))} day(s) ago`
          : `${Math.ceil(remaining)} day(s) left`;

        const safeUrl = conf.url
          ? `<a href="${escapeHtml(conf.url)}" target="_blank" rel="noopener">CFP</a>`
          : '—';

        return `
          <div class="list-group-item">
            <div class="row">
              <div class="col-sm-7">
                <div class="conf-title">${escapeHtml(conf.name)}</div>
                <div class="conf-meta">${escapeHtml(conf.category || 'Other')} • ${escapeHtml(conf.rank || '—')} • ${escapeHtml(conf.location || 'No location')}</div>
                <div class="conf-meta" style="margin-top: 6px;">Source: ${escapeHtml(conf.source || 'manual')} • Link: ${safeUrl}</div>
              </div>
              <div class="col-sm-3" style="margin-top: 6px;">
                <div><strong>Deadline</strong></div>
                <div class="conf-meta">${formatDate(conf.deadline)}</div>
              </div>
              <div class="col-sm-2" style="margin-top: 6px;">
                <div style="margin-bottom: 6px;"><span class="label ${status.cls}">${status.label}</span></div>
                <div class="conf-meta">${humanRemaining}</div>
                <div class="conf-meta">Reminder: ${Number(conf.notifyDays || 14)} day(s) before</div>
              </div>
            </div>
            <div class="small-actions">
              <button class="btn btn-xs btn-default" type="button" onclick="startEditConference('${conf.id}')">Edit</button>
              <button class="btn btn-xs btn-danger" type="button" onclick="deleteConference('${conf.id}')">Delete</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function escapeHtml(value) {
      return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function getServerBaseUrl() {
      // If this page is hosted on GitHub Pages, the API is hosted on Vercel.
      // If hosted on Vercel, same-origin API calls are fine.
      const host = window.location.host;
      if (host.endsWith('.vercel.app')) return '';
      return 'https://lengocluyen.vercel.app';
    }

    async function saveToServer() {
      // attempt to persist conferences to Vercel API; failures are non-fatal
      try {
        const apiBase = getServerBaseUrl();
        const resp = await fetch(`${apiBase}/api/save-conferences`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ conferences }),
        });

        if (!resp.ok) {
          const body = await resp.json().catch(() => ({}));
          console.error('server save failed', resp.status, body);
          els.notifStatus.textContent = `Server save failed (${resp.status}).`;
          setTimeout(() => {
            if (els.notifStatus.textContent.startsWith('Server save failed')) {
              els.notifStatus.textContent = '';
            }
          }, 4000);
        }
      } catch (e) {
        console.error('server save failed', e);
        els.notifStatus.textContent = 'Server save failed (network/CORS).';
        setTimeout(() => {
          if (els.notifStatus.textContent.startsWith('Server save failed')) {
            els.notifStatus.textContent = '';
          }
        }, 4000);
      }
    }

    function addConference() {
      const name = els.nameInput.value.trim();
      const deadline = els.deadlineInput.value;
      if (!name || !deadline) {
        alert('Please provide at least a conference name and deadline.');
        return;
      }

      const updated = {
        name,
        rank: els.rankInput.value.trim(),
        location: els.locationInput.value.trim(),
        url: els.urlInput.value.trim(),
        deadline,
        notifyDays: Number(els.notifyDaysInput.value || 14),
        category: els.categoryInput.value,
        source: els.sourceInput.value.trim()
      };

      if (editingId) {
        conferences = conferences.map(c => (c.id === editingId ? { ...c, ...updated } : c));
        exitEditMode();
        showTab('list');
      } else {
        conferences.push({ id: uid(), ...updated });
        clearForm();
      }

      saveConferences();
      render();
      runReminderCheck();
      saveToServer();
    }

    function clearForm() {
      els.nameInput.value = '';
      els.rankInput.value = '';
      els.locationInput.value = '';
      els.urlInput.value = '';
      els.deadlineInput.value = '';
      els.notifyDaysInput.value = 14;
      els.categoryInput.value = 'AI';
      els.sourceInput.value = '';
    }

    function enterEditMode(conf) {
      editingId = conf.id;
      els.formTitle.textContent = 'Edit a conference';
      els.addBtn.textContent = 'Save changes';
      els.cancelEditBtn.style.display = '';

      els.nameInput.value = conf.name || '';
      els.rankInput.value = conf.rank || '';
      els.locationInput.value = conf.location || '';
      els.urlInput.value = conf.url || '';
      els.deadlineInput.value = conf.deadline ? String(conf.deadline).slice(0, 16) : '';
      els.notifyDaysInput.value = Number(conf.notifyDays ?? 14);
      els.categoryInput.value = conf.category || 'AI';
      els.sourceInput.value = conf.source || '';
    }

    function exitEditMode() {
      editingId = null;
      els.formTitle.textContent = 'Add a conference';
      els.addBtn.textContent = 'Add conference';
      els.cancelEditBtn.style.display = 'none';
      clearForm();
    }

    function deleteConference(id) {
      conferences = conferences.filter(c => c.id !== id);
      delete notifiedMap[id];
      saveConferences();
      saveNotifiedMap();
      render();
      saveToServer();
    }

    function startEditConference(id) {
      const conf = conferences.find(c => c.id === id);
      if (!conf) return;
      enterEditMode(conf);
      showTab('add');
    }

    window.deleteConference = deleteConference;
    window.startEditConference = startEditConference;


    async function requestNotificationPermission() {
      if (!('Notification' in window)) {
        els.notifStatus.textContent = 'Notifications are not supported in this browser.';
        return;
      }
      const permission = await Notification.requestPermission();
      updateNotifStatus(permission);
    }

    function updateNotifStatus(permission = Notification.permission) {
      els.notifStatus.textContent = `Notification permission: ${permission}`;
    }

    function maybeNotify(conf, remainingDays) {
      if (!('Notification' in window) || Notification.permission !== 'granted') return;
      const key = `${conf.id}-${new Date(conf.deadline).toDateString()}`;
      if (notifiedMap[key]) return;

      new Notification(`Conference reminder: ${conf.name}`, {
        body: `Deadline in ${Math.ceil(remainingDays)} day(s): ${formatDate(conf.deadline)}`,
        tag: key
      });

      notifiedMap[key] = true;
      saveNotifiedMap();
    }

    function runReminderCheck() {
      let foundCount = 0;
      conferences.forEach(conf => {
        const remaining = daysRemaining(conf.deadline);
        const notifyDays = Number(conf.notifyDays || 14);
        if (remaining >= 0 && remaining <= notifyDays) {
          maybeNotify(conf, remaining);
          foundCount++;
        }
      });

      // show feedback to user
      const msg = `Reminder check complete. Found ${foundCount} conference(s) due soon.`;
      els.notifStatus.textContent = msg;
      setTimeout(() => {
        els.notifStatus.textContent = '';
      }, 3000);
    }

    function exportJson() {
      const blob = new Blob([JSON.stringify(conferences, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'conferences.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJson() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = async (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        try {
          const text = await file.text();
          const data = JSON.parse(text);
          if (!Array.isArray(data)) throw new Error('Invalid format');
          conferences = data.map(item => ({ ...item, id: item.id || uid() }));
          notifiedMap = {};
          saveConferences();
          saveNotifiedMap();
          render();
          runReminderCheck();
          saveToServer();
        } catch {
          alert('Invalid JSON file.');
        }
      };
      input.click();
    }

    document.getElementById('addBtn').addEventListener('click', addConference);
    document.getElementById('cancelEditBtn').addEventListener('click', () => {
      exitEditMode();
      showTab('list');
    });
    document.getElementById('exportBtn').addEventListener('click', exportJson);
    document.getElementById('importBtn').addEventListener('click', importJson);
    document.getElementById('enableNotifBtn').addEventListener('click', requestNotificationPermission);
    document.getElementById('checkNowBtn').addEventListener('click', runReminderCheck);

    // tab logic
    function showTab(tab) {
      document.getElementById('tabList').classList.toggle('active', tab === 'list');
      document.getElementById('tabAdd').classList.toggle('active', tab === 'add');
      document.getElementById('sectionList').style.display = tab === 'list' ? 'block' : 'none';
      document.getElementById('sectionAdd').style.display = tab === 'add' ? 'block' : 'none';
    }

    document.getElementById('tabList').addEventListener('click', () => showTab('list'));
    document.getElementById('tabAdd').addEventListener('click', () => showTab('add'));

    // initial state
    showTab('list');

    // after functions defined we initialize
    (async () => {
      conferences = await loadConferences();
      notifiedMap = loadNotifiedMap();

      updateNotifStatus(typeof Notification !== 'undefined' ? Notification.permission : 'unsupported');
      render();
      runReminderCheck();
      setInterval(runReminderCheck, 60 * 1000);
    })();
  </script>
